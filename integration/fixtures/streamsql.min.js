!function(t){"function"==typeof define&&define.amd?define("streamsql",t):t()}((function(){"use strict";var t,e=function(t){return new Error("[StreamSQL] Error: "+t)},i=function(t){return t&&t.length?t[0].toUpperCase()+t.slice(1).toLowerCase():t},n=function(){function t(t,e){this.url=t,this.apiKey=e,this.xhr=void 0,this.xhr=this.buildRequest(this.url,this.apiKey)}var i=t.prototype;return i.send=function(t,i){var n=this;return this.xhr=this.buildRequest(this.url,this.apiKey),new Promise((function(r,s){n.xhr.onreadystatechange=function(){if(this.readyState===this.DONE)if(i&&i(this.status,this.responseText),this.status>=200&&this.status<400)try{r(this.response)}catch(t){s(t)}else if(this.status)try{s(this.response)}catch(t){s(t)}else s(e("something went wrong sending XMLHttpRequest"))};try{n.xhr.send(JSON.stringify(t))}catch(t){s(t)}}))},i.buildRequest=function(t,e){var i=new XMLHttpRequest;return i.open("POST",t,!0),i.setRequestHeader("Content-Type","application/json; charset=UTF-8"),i.setRequestHeader("x-streamsql-key",e),i.withCredentials=!0,i.timeout=3e3,i},t}();!function(t){t.None="None",t.Lax="Lax",t.Strict="Strict"}(t||(t={}));var r=function(){function e(){this.simpleCookies=new Map}var n=e.prototype;return n.setCookie=function(e){if(!e.maxAge&&!e.expires){var i=new Date;i.setFullYear(i.getFullYear()+1),e.expires=i.toUTCString()}e.secure=!0,e.sameSite=t.None,this.simpleCookies.set(e.name,e.value),document.cookie=this.toCookieString(e)},n.getCookie=function(t){if(this.simpleCookies.has(t))return this.simpleCookies.get(t);var e="";try{for(var i=t+"=",n=document.cookie.split(";"),r=0;r<n.length;r++){for(var s=n[r];" "===s.charAt(0);)s=s.substring(1);if(0===s.indexOf(i)){e=s.substring(i.length,s.length);break}}return e}catch(t){return e}},n.clearCookie=function(t){this.simpleCookies.delete(t);var e=new Date;e.setTime(0),this.setCookie({name:t,value:"",maxAge:0,expires:e.toUTCString()})},n.toCookieString=function(t){var e=[t.name+"="+t.value];delete t.name,delete t.value;for(var n=0,r=Object.entries(t);n<r.length;n++){var s=r[n],o=s[0],u=s[1];"httpOnly"===o?e.push("HttpOnly"):"sameSite"===o?e.push("SameSite="+u):"maxAge"===o?e.push("MaxAge="+u):"boolean"==typeof u&&u?e.push(""+i(o)):e.push(i(o)+"="+u)}return e.join("; ")},e}(),s=function(){function t(){this.userId="",this.ch=new r}var e=t.prototype;return e.setUser=function(t){this.userId=t,this.ch.setCookie({name:"__ssqlclient_uid",value:t})},e.getUser=function(){return this.userId||this.ch.getCookie("__ssqlclient_uid")},e.deleteUser=function(){this.userId="",this.ch.clearCookie("__ssqlclient_uid")},t}(),o=function(){function t(){}var e=t.prototype;return e.location=function(){return this.isWindow("location")&&window.location.href||""},e.referrer=function(){return this.isDocument()&&document.referrer||""},e.title=function(){return this.isDocument()&&document.title||""},e.isWindow=function(t){return"undefined"!=typeof window&&window.hasOwnProperty(t)},e.isDocument=function(){return this.isWindow("document")&&"undefined"!=typeof document},t}(),u=new(function(){function t(){this.fetcher=void 0,this.identifier=void 0,this.pageCtx=void 0}var i=t.prototype;return i.init=function(t){if(!function(t){return!!t}(t))throw e("api key is invalid");return this.fetcher=new n("https://wildcard.localhost.com:9001/api/send/single",t),this.identifier=new s,this.pageCtx=new o,this},i.identify=function(t){return this.identifier||this.throwNoInitError(),this.identifier.setUser(t),this.onIdentify(t),this},i.unidentify=function(){return this.identifier||this.throwNoInitError(),this.identifier.deleteUser(),this.onUnidentify(),this},i.sendEvent=function(t,e,i){this.fetcher||this.throwNoInitError(),this.fetcher.send(this.buildData(t,e),i).catch((function(t){}))},i.buildData=function(t,e){this.pageCtx&&this.identifier||this.throwNoInitError();var i={timestamp:(new Date).getTime(),context:{url:this.pageCtx.location(),referrer:this.pageCtx.referrer(),title:this.pageCtx.title()},user:{id:this.identifier.getUser()}},n=e?Object.assign({},i,e):i;return{stream:t.toLowerCase(),data:n}},i.throwNoInitError=function(){throw e("api key must be set first: streamsql.init(apiKey)")},i.onIdentify=function(t){},i.onUnidentify=function(){},t}());!function(t,e,i){t.streamsql=t.streamsql||u}(window)}));
